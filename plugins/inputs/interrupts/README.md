# Interrupts Input Plugin

The interrupts plugin gathers metrics about IRQs from `/proc/interrupts`, `/proc/softirqs`, 
and `/proc/irq/IRQ_NUMBER/spurious`

### Configuration
```toml
[[inputs.interrupts]]
  ## When set to true, cpu metrics are tagged with the cpu.  Otherwise cpu is
  ## stored as a field.
  ##
  ## The default is false for backwards compatibility, and will be changed to
  ## true in a future version.  It is recommended to set to true on new
  ## deployments.
  # cpu_as_tag = false

  ## spurious interrupt counters can be collected
  # spurious = false

  ## To filter which IRQs to collect, make use of tagpass / tagdrop, i.e.
  # [inputs.interrupts.tagdrop]
  #   irq = [ "NET_RX", "TASKLET" ]
```

### Measurements

There are two styles of `interrupts` and `soft_interrupts` depending on the value of `cpu_as_tag`.
When `cpu_as_tag` is `false` the per-CPU count is in a field. When `true` the CPU is a tag and
there is one point per interrupt per CPU. Having the CPU as a tag easily allows queries by-CPU at
the cost of requiring greater cardinality.

For `spurious_interrupts` there is only a per-interrupt counter available; no per-CPU info is 
available.

#### interrupts
The `interrupts` measurement reports the hard interrupt data collected from the 
`/proc/interrupts` file in Linux.
These interrupts are typically from hardware devices, but can be also generated by 
software, such as timers and interprocessor interrupts.

##### interrupts tags
| cpu_as_tag | tag | description |
|:---:|:---:|---|
| - | device | description of device |
| - | irq | IRQ name (ephemeral, could be a number) |
| - | type | interrupt type |
| true | cpu | CPU number |

##### interrupts fields 
| cpu_as_tag | field | counter | units | description |
|:---:|:---:|:---:|:---:|---|
| - | count | counter | events | number of times the interrupt has been triggered |
| false | cpu# | counter | events | number of times the interrupt has been handled by CPU _#_ |
| false | total | counter | events | total number of times the interrupt has been handled by all CPUs |

#### soft_interrupts
The `soft_interrupts` measurement reports the soft interrupt data collected from the 
`/proc/softirqs` file in Linux.

Note: for some Linux systems there can be fixed, large number of CPUs reported in
the `/proc/softirqs` file. This number could be much larger than the actual number of 
CPUs in the system. The fields for these phantom CPUs contain zeroes. The approach
taken to remove these phantom CPUs is to remove the columns containing all zeros
to the right (higher CPU numbers). For systems where CPUs are dynamically enabled,
this can lead to CPUs not being reported until enabled. However, this is preferable
to collecting metrics for tens or hundreds of phantom CPUs. For queries with fixed
numbers of CPUs, consider using `fill(0)` rather than `fill(null)`

##### soft_interrupts tags
| cpu_as_tag | tag | description |
|:---:|:---:|---|
| - | irq | IRQ name |
| true | cpu | CPU number |

##### soft_interrupts fields 
| cpu_as_tag | field | type | units | description |
|:---:|:---:|:---:|:---:|---|
| false | cpu# | counter | events | number of times the interrupt has been handled by CPU _#_ |
| false | total | counter | events | total number of times the interrupt has been handled by all CPUs |
| true | count | counter | events | number of times the interrupt has been handled by CPU in the tag |


#### spurious_interrupts
The `spurious_interrupts` measurement reports the number of spurious interrupts triggered
and unhandled for IRQs. This data is collected from the `/proc/irq/IRQ/spurious` file.
This data is identified by IRQ and not per-CPU.

##### spurious_interrupts tags
| tag | description |
|:---:|---|
| device | description of device |
| irq | IRQ name |
| type | interrupt type |

##### spurious_interrupts fields 
| field | type | units | description |
|:---:|:---:|:---:|---|
| count | counter | events | number of times the interrupt has been handled (modulo 100,000) |
| total | counter | events | total number of times the interrupt has been handled |
| unhandled | counter | events | number of times an interrupt was not handled |

### Example Output

With `cpu_as_tag = false`:
```
interrupts,irq=0,type=IO-APIC,device=2-edge\ timer cpu0=23i,cpu1=0i,total=23i 1489346531000000000
interrupts,irq=1,type=IO-APIC,device=1-edge\ i8042 cpu0=4i,cpu1=5i,total=9i 1489346531000000000
interrupts,irq=30,type=PCI-MSI,device=65537-edge\ virtio1-input.0 cpu0=2i,cpu1=40i,total=42i 1489346531000000000
soft_interrupts,irq=NET_RX cpu0=140412i,cpu1=140467,total=280879i 1489346531000000000
```

With `cpu_as_tag = true`:
```
interrupts,cpu=cpu6,irq=PIW,type=Posted-interrupt\ wakeup\ event count=0i 1543539773000000000
interrupts,cpu=cpu7,irq=PIW,type=Posted-interrupt\ wakeup\ event count=0i 1543539773000000000
soft_interrupts,cpu=cpu0,irq=HI count=246441i 1543539773000000000
soft_interrupts,cpu=cpu1,irq=HI count=159154i 1543539773000000000
```

With `spurious = true` add to the above:
```
spurious_interrupts,device=17-fasteoi\ ioc0,irq=17,type=IO-APIC count=27836i,total=327836i,unhandled=0i 1551582077000000000
```